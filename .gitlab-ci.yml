build-job:
  stage: build
  script:
    - apt update
    - apt install -y build-essential wget
    - wget https://github.com/bazelbuild/bazelisk/releases/download/v1.20.0/bazelisk-linux-amd64
    - chmod +x bazelisk-linux-amd64
    - mv bazelisk-linux-amd64 /usr/bin/bazel
    - echo "build --remote_header=x-buildbuddy-api-key=${BUILDBUDDY_TOKEN}" > user.bazelrc
    - bazel build --config=ci --keep_going //...
    - bazel test --config=ci --keep_going //...
    - bazel run --config=ci --keep_going //exploration/winding/benches:plane2d_from_points
    - bazel run --config=ci --keep_going //exploration/winding/benches:plane2d_intersection